{"version":3,"file":"index.js","sources":["../../../../src/index.js"],"sourcesContent":["import createMessagebirdClient from 'messagebird'\nimport {PlanorService} from '@planorjs/core'\n\nexport default class PlanorServiceMessagebird extends PlanorService {\n  constructor(credentials, opts={}) {\n    super('messagebird', 'sms')\n\n    this.credentialKeys = ['origin', 'accessKey']\n\n    this.setCredentials(credentials)\n    this.setOpts(opts)\n  }\n\n  async getClient() {\n    const creds = super.getCredentials()\n\n    this.client = createMessagebirdClient(creds.accessKey)\n\n    return this.client\n  }\n\n  async send(msg, msgopts) {\n    const self = this\n    const creds = super.getCredentials()\n\n    if (typeof msgopts.to == 'string') msgopts.to = [msgopts.to]\n\n    return new Promise(function(resolve, reject) {\n      const payload = {\n        originator: creds.origin,\n        recipients: msgopts.to.map(r => r.replace('+', '')),\n        body: msg\n      }\n\n      self.client.messages.create(payload, function(err, resp) {\n        if (err) {\n          return reject(new Error(`Couldn't send sms.`, {cause: err}))\n        }\n\n        return resolve(resp)\n      })\n    })\n  }\n}\n"],"names":["PlanorServiceMessagebird","PlanorService","constructor","credentials","opts","credentialKeys","setCredentials","setOpts","getClient","creds","getCredentials","client","createMessagebirdClient","accessKey","send","msg","msgopts","self","to","Promise","resolve","reject","payload","originator","origin","recipients","map","r","replace","body","messages","create","err","resp","Error","cause"],"mappings":";;;AAGe,MAAMA,wBAAN,SAAuCC,aAAvC,CAAqD;AAClEC,EAAAA,WAAW,CAACC,WAAD,EAAcC,IAAI,GAAC,EAAnB,EAAuB;AAChC,UAAM,aAAN,EAAqB,KAArB;AAEA,SAAKC,cAAL,GAAsB,CAAC,QAAD,EAAW,WAAX,CAAtB;AAEA,SAAKC,cAAL,CAAoBH,WAApB;AACA,SAAKI,OAAL,CAAaH,IAAb;AACD;;AAEc,QAATI,SAAS,GAAG;AAChB,UAAMC,KAAK,GAAG,MAAMC,cAAN,EAAd;AAEA,SAAKC,MAAL,GAAcC,uBAAuB,CAACH,KAAK,CAACI,SAAP,CAArC;AAEA,WAAO,KAAKF,MAAZ;AACD;;AAES,QAAJG,IAAI,CAACC,GAAD,EAAMC,OAAN,EAAe;AACvB,UAAMC,IAAI,GAAG,IAAb;AACA,UAAMR,KAAK,GAAG,MAAMC,cAAN,EAAd;AAEA,QAAI,OAAOM,OAAO,CAACE,EAAf,IAAqB,QAAzB,EAAmCF,OAAO,CAACE,EAAR,GAAa,CAACF,OAAO,CAACE,EAAT,CAAb;AAEnC,WAAO,IAAIC,OAAJ,CAAY,UAASC,OAAT,EAAkBC,MAAlB,EAA0B;AAC3C,YAAMC,OAAO,GAAG;AACdC,QAAAA,UAAU,EAAEd,KAAK,CAACe,MADJ;AAEdC,QAAAA,UAAU,EAAET,OAAO,CAACE,EAAR,CAAWQ,GAAX,CAAeC,CAAC,IAAIA,CAAC,CAACC,OAAF,CAAU,GAAV,EAAe,EAAf,CAApB,CAFE;AAGdC,QAAAA,IAAI,EAAEd;AAHQ,OAAhB;AAMAE,MAAAA,IAAI,CAACN,MAAL,CAAYmB,QAAZ,CAAqBC,MAArB,CAA4BT,OAA5B,EAAqC,UAASU,GAAT,EAAcC,IAAd,EAAoB;AACvD,YAAID,GAAJ,EAAS;AACP,iBAAOX,MAAM,CAAC,IAAIa,KAAJ,CAAW,oBAAX,EAAgC;AAACC,YAAAA,KAAK,EAAEH;AAAR,WAAhC,CAAD,CAAb;AACD;;AAED,eAAOZ,OAAO,CAACa,IAAD,CAAd;AACD,OAND;AAOD,KAdM,CAAP;AAeD;;AAvCiE;;;;"}