{"version":3,"file":"index.js","sources":["../../src/index.js"],"sourcesContent":["import createMessagebirdClient from 'messagebird'\nimport {PlanorService} from '@planorjs/core'\n\nexport default class PlanorServiceMessagebird extends PlanorService {\n  constructor(credentials, opts={}) {\n    super('messagebird', 'sms')\n\n    this.credentialKeys = ['origin', 'accessKey']\n\n    this.setCredentials(credentials)\n    this.setOpts(opts)\n  }\n\n  async getClient() {\n    const creds = super.getCredentials()\n\n    this.client = createMessagebirdClient(creds.accessKey)\n\n    return this.client\n  }\n\n  async send(msg, msgopts) {\n    const self = this\n    const creds = super.getCredentials()\n\n    return new Promise(function(resolve, reject) {\n      const payload = {\n        originator: creds.origin,\n        recipients: msgopts.to.map(r => r.replace('+', '')),\n        body: msg\n      }\n\n      self.client.messages.create(payload, function(err, resp) {\n        if (err) {\n          return reject(new Error(`Couldn't send sms.`, {cause: err}))\n        }\n\n        return resolve(resp)\n      })\n    })\n  }\n}\n"],"names":["PlanorService","createMessagebirdClient"],"mappings":";;;;;;;;;AAGe,MAAM,wBAAwB,SAASA,kBAAa,CAAC;AACpE,EAAE,WAAW,CAAC,WAAW,EAAE,IAAI,CAAC,EAAE,EAAE;AACpC,IAAI,KAAK,CAAC,aAAa,EAAE,KAAK,EAAC;AAC/B;AACA,IAAI,IAAI,CAAC,cAAc,GAAG,CAAC,QAAQ,EAAE,WAAW,EAAC;AACjD;AACA,IAAI,IAAI,CAAC,cAAc,CAAC,WAAW,EAAC;AACpC,IAAI,IAAI,CAAC,OAAO,CAAC,IAAI,EAAC;AACtB,GAAG;AACH;AACA,EAAE,MAAM,SAAS,GAAG;AACpB,IAAI,MAAM,KAAK,GAAG,KAAK,CAAC,cAAc,GAAE;AACxC;AACA,IAAI,IAAI,CAAC,MAAM,GAAGC,2CAAuB,CAAC,KAAK,CAAC,SAAS,EAAC;AAC1D;AACA,IAAI,OAAO,IAAI,CAAC,MAAM;AACtB,GAAG;AACH;AACA,EAAE,MAAM,IAAI,CAAC,GAAG,EAAE,OAAO,EAAE;AAC3B,IAAI,MAAM,IAAI,GAAG,KAAI;AACrB,IAAI,MAAM,KAAK,GAAG,KAAK,CAAC,cAAc,GAAE;AACxC;AACA,IAAI,OAAO,IAAI,OAAO,CAAC,SAAS,OAAO,EAAE,MAAM,EAAE;AACjD,MAAM,MAAM,OAAO,GAAG;AACtB,QAAQ,UAAU,EAAE,KAAK,CAAC,MAAM;AAChC,QAAQ,UAAU,EAAE,OAAO,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;AAC3D,QAAQ,IAAI,EAAE,GAAG;AACjB,QAAO;AACP;AACA,MAAM,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,OAAO,EAAE,SAAS,GAAG,EAAE,IAAI,EAAE;AAC/D,QAAQ,IAAI,GAAG,EAAE;AACjB,UAAU,OAAO,MAAM,CAAC,IAAI,KAAK,CAAC,CAAC,kBAAkB,CAAC,EAAE,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC,CAAC;AACtE,SAAS;AACT;AACA,QAAQ,OAAO,OAAO,CAAC,IAAI,CAAC;AAC5B,OAAO,EAAC;AACR,KAAK,CAAC;AACN,GAAG;AACH;;;;"}